"use strict";var R=Object.create;var d=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var G=(n,e)=>{for(var t in e)d(n,t,{get:e[t],enumerable:!0})},x=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of B(e))!z.call(n,o)&&o!==t&&d(n,o,{get:()=>e[o],enumerable:!(r=q(e,o))||r.enumerable});return n};var k=(n,e,t)=>(t=n!=null?R(J(n)):{},x(e||!n||!n.__esModule?d(t,"default",{value:n,enumerable:!0}):t,n)),V=n=>x(d({},"__esModule",{value:!0}),n);var Y={};G(Y,{default:()=>F});module.exports=V(Y);var P=require("@raycast/api"),l=require("react");var A=require("@raycast/api"),L=require("fs"),O=k(require("path"));function W(n){return O.default.normalize(n).startsWith("/System/")}function v(n){return n.filter(e=>W(e.path)===!1).sort((e,t)=>e.name.localeCompare(t.name))}async function U(n){return L.promises.access(n).then(()=>!0).catch(()=>!1)}function y(n,e="Error"){(0,A.showToast)({style:A.Toast.Style.Failure,title:e,message:n})}async function j(n=500){return new Promise(e=>setTimeout(e,n))}function C(n){return n!=null&&typeof n=="object"}function I(n,e){let t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(let o of t){let i=n[o],m=e[o],u=C(i)&&C(m);if(!u&&i!==m||u&&!I(i,m))return!1}return!0}var w=require("@raycast/api"),N=k(require("events"));var g=class{cache;emitter;constructor(){this.cache=new w.Cache,this.emitter=new N.default}async getApps(){let e=this.readCache();e.length&&(this.emitter.emit("update",e),await j()),(0,w.getApplications)().then(t=>v(t)).then(t=>this.enrich(t)).then(t=>{I(t,e)||(this.saveCache(t),this.emitter.emit("update",t))}).catch(t=>{console.error("Failed to fetch or process applications:",t),this.emitter.emit("error",t)})}enrich(e){let t=[];for(let r of e){let o=r.path.split("/").slice(1,-1).join("/"),i=r.bundleId?.split(".")[1]||"";i=i.charAt(0).toUpperCase()+i.slice(1),t.push({...r,brand:i,location:o})}return t}saveCache(e){this.cache.set("apps",JSON.stringify(e))}readCache(){let e=this.cache.get("apps");return e?JSON.parse(e):[]}};var E=require("@raycast/api"),T=require("child_process");var S=[{id:"appcleaner",name:"AppCleaner",path:"/Applications/AppCleaner.app",url:"https://freemacsoft.net/appcleaner/",icon:"icon.png"},{id:"pearcleaner",name:"Pearcleaner",path:"/Applications/PearCleaner.app",url:"https://itsalin.com/appInfo/?id=pearcleaner",icon:"pearcleaner.png"},{id:"trashme",name:"TrashMe 3",path:"/Applications/TrashMe 3.app",url:"https://www.jibapps.com/apps/trashme3/",icon:"trashme.png"}],p=class n{static async getUninstaller(){let e=(0,E.getPreferenceValues)().uninstaller_app,t=Array.from(S);e&&t.sort((r,o)=>r.id===e?-1:o.id===e?1:0);for(let r of t)if(await U(r.path))return r}static checkDependencies(){return n.getUninstaller().then(e=>{if(!e)throw new Error("No uninstaller app found.");(0,E.updateCommandMetadata)({subtitle:"with "+e.name})})}static async launch(e){let t=await n.getUninstaller();return t?new Promise((r,o)=>{(0,T.exec)(`open -a "${t.path}" "${e.path}"`,i=>{if(i)return o(i);r()})}):Promise.reject(new Error("No uninstaller app found."))}};var a=require("@raycast/api");var f=require("react/jsx-runtime");function $({app:n}){function e(){p.launch(n).catch(t=>{y(t.toString())})}return(0,f.jsx)(a.List.Item,{title:n.name,subtitle:"by "+n.brand,accessories:[{text:"in "+n.location}],icon:{fileIcon:n.path},actions:(0,f.jsx)(a.ActionPanel,{children:(0,f.jsx)(a.ActionPanel.Section,{children:(0,f.jsx)(a.Action,{title:"Uninstall",onAction:e})})})})}var c=require("@raycast/api");var b=require("react/jsx-runtime");function D(){let n=`
# You need at least one of the following uninstallers installed:
${S.map(t=>`- [${t.name}](${t.url})`).join(`
`)}
`,e=S.map(t=>(0,b.jsx)(c.Action.OpenInBrowser,{icon:t.icon,title:`Get ${t.name}`,url:t.url},t.id));return(0,b.jsx)(c.Detail,{markdown:n,navigationTitle:"Error",actions:(0,b.jsx)(c.ActionPanel,{children:e})})}var h=require("react/jsx-runtime"),M=new g;function F(){let[n,e]=(0,l.useState)(!1),[t,r]=(0,l.useState)([]),[o,i]=(0,l.useState)(!0);(0,l.useEffect)(()=>{p.checkDependencies().then(()=>M.getApps()).catch(()=>e(!0)),M.emitter.on("update",m).on("error",u)},[]);function m(s){i(!1),r(s)}function u(s){i(!1),r([]),y(s.message,"Fetching applications failed.")}return n?(0,h.jsx)(D,{}):(0,h.jsx)(P.List,{isLoading:o,searchBarPlaceholder:"Search Applications...",children:(0,h.jsx)(P.List.Section,{title:"Results",subtitle:t?.length+"",children:t?.map(s=>(0,h.jsx)($,{app:s},s.path))})})}
